  steps:
  # Build the Docker image
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'europe-west1-docker.pkg.dev/data-academy-project-411312/docker-rep-demo/demo-app', 'app/']

  # Push the image to Artifact Registry
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'europe-west1-docker.pkg.dev/data-academy-project-411312/docker-rep-demo/demo-app']

  # Set up kubectl
  - name: 'gcr.io/cloud-builders/kubectl'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        gcloud container clusters get-credentials autopilot-cluster-1 --zone europe-west1 --project data-academy-project-411312
        kubectl set image deployment/demo-app demo-app-container=europe-west1-docker.pkg.dev/data-academy-project-411312/docker-rep-demo/demo-app

images:
  - 'europe-west1-docker.pkg.dev/data-academy-project-411312/docker-rep-demo/demo-app'



#   steps:
# - name: 'gcr.io/cloud-builders/git'
#   args: ['clone', 'https://github.com/GeraldJG/poc-cicd2.git']


# - name: 'gcr.io/cloud-builders/docker'
#   args: ['build', '-t', 'europe-west3-docker.pkg.dev/de0360-sbx-gda3sandboxgj-gj/gda3-cicd-docker-repo/cicd2-app', '.']


# # Push the image to Artifact Registry
# - name: 'gcr.io/cloud-builders/docker'
#   args: ['push', 'europe-west3-docker.pkg.dev/de0360-sbx-gda3sandboxgj-gj/gda3-cicd-docker-repo/cicd2-app']  
  
# # start container as job using  cloud run
# - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
#   entrypoint: gcloud
#   args:
#   - 'run'
#   - 'jobs'
#   - 'deploy'
#   - 'cicd2-app'
#   - '--image'
#   - 'europe-west3-docker.pkg.dev/de0360-sbx-gda3sandboxgj-gj/gda3-cicd-docker-repo/cicd2-app'
#   - '--region'
#   - 'europe-west3'
#   - '--execute-now'
# images:
# - 'europe-west3-docker.pkg.dev/de0360-sbx-gda3sandboxgj-gj/gda3-cicd-docker-repo/cicd2-app'